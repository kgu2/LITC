<template>
  <!-- Spinner -->
  <template if:true={isPageLoading}>
    <c-spinner variant="brand"
               alternative-text="Loading..."
               theme={_theme}
               size="medium">
    </c-spinner>
  </template>
  <div class="nds-file-custom-selector nds-form-container">
    <div class="nds-file-selector__dropzone">
      <div class="nds-form-element nds-p-around--small">
        <slot>
          <div class={_containerClasses}>
            <div>
              <label class="nds-form-element__label omni-input-label"
                     aria-label={_propSetMap.label}
                     for="imageUpload">
                <abbr if:true={_propSetMap.required}
                      class="nds-required"
                      title="required">*</abbr>
                <span>{_propSetMap.label}</span>
              </label>
              <c-tooltip if:true={_propSetMap.help}
                         class="nds-tooltip_container"
                         theme={_theme}
                         content={_propSetMap.helpText}
                         aria-hidden="true">
              </c-tooltip>
            </div>
            <div class="nds-grid omni-file-input">
              <lightning-file-upload label={_propSetMap.label}
                                     id="imageUpload"
                                     name={jsonDef.lwcId}
                                     record-id={scriptHeaderDef.sOmniScriptId}
                                     onuploadfinished={handleUploadFinished}
                                     multiple={multiple}
                                     accept={accepts}
                                     disabled={disabled}
                                     class="nds-has-dividers_around-space omni-file nds-m-bottom_xx-small nds-size_12-of-12 nds-medium-size_12-of-12">
              </lightning-file-upload>
            </div>
          </div>
        </slot>
      </div>
    </div>
    <slot name="files">
      <span id="upload-status"
            class="nds-assistive-text">{ariaLiveStatusText}</span>
      <div aria-labelledby="upload-status"
           aria-live={ariaLiveStatus}></div>
      <div class="nds-grid">
        <ul class="nds-has-dividers_around-space omni-file nds-m-bottom_xx-small nds-size_12-of-12 nds-medium-size_12-of-12">
          <template for:each={images}
                    for:item="item"
                    for:index="index">
            <li key={item.data}
                class="omni-image">
              <div class="nds-m-bottom--small">
                <img src={item.url}
                     alt={item.filename} />
              </div>
              <div class="nds-box nds-grid omni-image-details">
                <span class="nds-m-bottom_xx-small nds-size_11-of-12 nds-medium-size_11-of-12 nds-truncate"
                      aria-hidden="true">
                  {item.filename}
                </span>
                <span class="remove-file-icon nds-m-bottom_xx-small nds-size_1-of-12 nds-medium-size_1-of-12 nds-text-align_right">
                  <button class="nds-button nds-button_icon"
                          title={item.deleteLabel}
                          onclick={deleteFile}
                          data-index={index}
                          data-id={item.data}>
                    <c-icon theme={_theme}
                            extraclass="nds-button__icon"
                            iconposition="left"
                            icon-name="action:delete"
                            color="brand"
                            alternative-text={item.deleteLabel}
                            size="x-small"
                            data-index={index}
                            data-id={item.data}></c-icon>
                  </button>
                </span>
              </div>
            </li>
          </template>
        </ul>
      </div>
    </slot>
    <div if:true={_showValidation}
         class="nds-has-error">
      <span class="nds-form-element__help omni-file-required">
        Required
      </span>
    </div>
  </div>
</template>